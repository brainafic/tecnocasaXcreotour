var accessToken="",nMutuoPerc=0,nMutuoPercAnticipo=0,folderMapChart="/web/default/mapChart/zone/";function aggiornaRiepilogoSalvaRicerca(){$("#contentRiepilogo").find("p").hide(),campiInput=$("form#salvaRicercaForm #filtri").find("input"),campiSelect=$("form#salvaRicercaForm #filtri .selectpicker"),campiSelectMulti=$("form#salvaRicercaForm #filtri").find('select[multiple="multiple"]'),valori={},$.each(campiInput,function(){"text"==$(this).attr("type")||"number"==$(this).attr("type")?valori[$(this).attr("name")]=$(this).val().trim():"checkbox"==$(this).attr("type")&&$(this).is(":checked")&&(valori[$(this).attr("name")]=aLang.si)}),$.each(campiSelect,function(){nome=$(this).attr("name"),selezionato=$(this).find("option:selected"),testo=selezionato.text().trim(),testo!=aLang.qualsiasi&&"ricercaDistretto[]"!=nome&&(valori[nome]=testo)}),$.each(campiSelectMulti,function(){nome=$(this).attr("name"),selected=$(this).find("option:selected"),testoMulti=new Array,$.each(selected,function(){testoMulti.push($(this).text())}),jQuery.isEmptyObject(testoMulti)||(valori[nome]=testoMulti.join(", "))}),$.each(valori,function(a,e){""!==e&&e!==aLang.qualsiasi&&(a=a.replace("[]",""),paragrafo=$("#"+a+"Riepilogo").slideDown(),paragrafo.find("span").text(e))})}function interoDistrettoSelezionato(a){return a.find("input[type=checkbox]:checked").length==a.find(".lista-quartieri li").length}function haQuartieriSelezionati(a){return null!=a.find("input[type=checkbox]:checked").val()}$(document).ready(function(){function s(a,e,t,i,r,c,o,l,n,s){$.post(baseUrlLingua+"ajax/ricercaDistretti",{tipo:a,id:e,valore:t,distretto:i,quartiere:r,comuneId:c,regioneSigla:o,provinciaSigla:l,contratto:$("select#ricercaContratto").val()}).done(function(a){if($("#boxSearchArea").html(a),0==$(a).find("#boxSearchAreaList .checkbox-distretto").length&&(a=0),0!=a){var e=$("select#ricercaContratto").val();1==$(a).find(".displayDistretti").attr("data-mostraCartina")&&getJsonAjax(folderMapChart+o+"/"+c+".json",0,i),$("#boxSearchArea .list-group").listgroup(),$(".lista-quartieri").each(function(a,e){$(this).find("input[type=checkbox]:checked").length&&($(this).show(),$(this).closest(".checkbox-distretto").addClass("ha-quartieri-selezionati"),IDArea=$(this).closest(".checkbox-distretto").find("input[type=checkbox]").attr("value"),addArea($("area[data-idarea="+IDArea+"]"),IDArea))}),"comune"==$("#boxSearchAreaList").attr("ricercatipo")?1==$("#boxSearchArea .list-group .list-group-item").length?setTimeout(function(){u($("#boxSearchArea .list-group .list-group-item"),1)},100):("alquiler"==e?$(".totJS").hide():$(".totJS").show(),$("#boxSearchArea, #boxSearchOverlay").show()):"distretto"==$("#boxSearchAreaList").attr("ricercatipo")?(setTimeout(function(){var a=$("#boxSearchAreaList").offset().top,e=$("input[name='"+$("#boxSearchAreaList").attr("ricercaid")+"']"),t=e.offset().top-a-e.outerHeight();$("#boxSearchAreaList").stop().animate({scrollTop:t},"slow")},100),"alquiler"==e?$(".totJS").hide():$(".totJS").show(),$("#boxSearchArea, #boxSearchOverlay").show()):"quartiere"==$("#boxSearchAreaList").attr("ricercatipo")&&(setTimeout(function(){var a=$("#boxSearchAreaList").offset().top,e=$("input[name='"+$("#boxSearchAreaList").attr("ricercaid")+"']"),t=e.offset().top-a-e.outerHeight();$("#boxSearchAreaList").stop().animate({scrollTop:t},"slow")},100),interoDistrettoSelezionato($("input[name='"+$("#boxSearchAreaList").attr("ricercaid")+"']").closest(".checkbox-distretto"))?$("input[name='"+$("#boxSearchAreaList").attr("ricercaid")+"']").closest(".checkbox-distretto").find("input[tipo=Distretto]").prop("checked",!0):($("input[name='"+$("#boxSearchAreaList").attr("ricercaid")+"']").closest(".checkbox-distretto").find("input[tipo=Distretto]").prop("checked",!1),$("input[name='"+$("#boxSearchAreaList").attr("ricercaid")+"']").closest(".checkbox-distretto").find(".lista-quartieri").slideToggle()),"alquiler"==e?$(".totJS").hide():$(".totJS").show(),$("#boxSearchArea, #boxSearchOverlay").show()),$("#boxSearchArea .list-group .list-group-item").click(function(){var a=$(this).attr("tipo");if("Provincia"==a||"Comune"==a)return u($(this)),!1;"Distretto"!=a&&"Quartiere"!=a||($(".boxSearchAreaOptionComune").removeClass("active"),$(".boxSearchAreaOptionProvincia").removeClass("active"),$("#ricercaTesto").val($(this).text()),$("#ricercaStringa").val($(this).attr("comunenome")),"alquiler"==e?$(".totJS").hide():$(".totJS").show(),$("#boxSearchArea, #boxSearchOverlay").show()),setTimeout(function(){$("#boxSearchAreaConferma").prop("disabled",0==$("#boxSearchArea .list-group .list-group-item.active").length)},100)})}else $("#ricercaTipo").val(n[0].toLowerCase()),$("#ricercaNazione").val(n[1]),$("#ricercaKeyUrl").val(n[2]),$("#ricercaValore").val(n[3]),$("#ricercaTesto").val(s),$("#ricercaStringa").val(n[2]),$("#ricercaInput").val(s),$("#ricercaDistretto").val(""),$("#ricercaQuartiere").val(""),valRicercaInput=s,$("#boxSearchAreaModifica").hide()})}function u(a,e){$("#ricercaInput").val(a.html()),$("#ricercaTipo").val(a.attr("tipo").toLowerCase()),$("#ricercaKeyUrl").val(a.attr("keyurl")),$("#ricercaValore").val(a.attr("value")),$("#ricercaStringa").val(a.attr("nome")),$("#ricercaTesto").val(a.html()),$("#ricercaDistretto").val(""),$("#ricercaQuartiere").val(""),valRicercaInput=$("#ricercaInput").val(),1!=e?$("#boxSearchAreaModifica").show():$("#boxSearchAreaModifica").hide()}if("distretto"==sRicercaModalita){var m=$("#ricercaTipo").val(),v=$("#ricercaNazione").val(),d=$("#ricercaKeyUrl").val(),p=$("#ricercaValore").val(),h=$("#ricercaTesto").val(),f=($("#ricercaCategoria").val(),$("#ricercaStringa").val()),t=$("#ricercaComune").val(),g=$("#ricercaInput").val(),b=0;$("#ricercaInput").length&&($("#ricercaInput").autocomplete({autoFocus:!0,minLength:3,source:function(a,t){var e=$("#ricercaInput").val().replace("’","'");$.ajax({type:"post",url:baseUrlLingua+"ajax/ricercaImmobiliAutocomplete",dataType:"json",data:{ricercaTesto:e,ricercaCategoria:$("#ricercaCategoria").val(),ricercaContratto:$("#ricercaContratto").val()},success:function(a){if(a.length)t(a.slice(0,50));else{var e=[{label:$("#immobiliNoResult").attr("msg"),value:t.term}];t(e)}}}),$(".imgImmobiliRicercaWait").css("display","block")},response:function(a,e){$(".imgImmobiliRicercaWait").hide(),provinceCount=0,comuniCount=0,distrettiCount=0,localitaCount=0,precisoCount=0},close:function(a,e){1!=b?($("#ricercaTipo").val(m),$("#ricercaNazione").val(v),$("#ricercaKeyUrl").val(d),$("#ricercaValore").val(p),$("#ricercaTesto").val(h),$("#ricercaStringa").val(f),0==$("#ricercaInput").is(":focus")&&$("#ricercaInput").val(g),b=0):($("#ricercaTipo").val(valRicercaTipo),$("#ricercaNazione").val(valRicercaNazione),$("#ricercaKeyUrl").val(valRicercaKeyUrl),$("#ricercaValore").val(valRicercaValore),$("#ricercaTesto").val(valRicercaTesto),$("#ricercaStringa").val(valRicercaStringa),$("#ricercaComune").val(t),0==$("#ricercaInput").is(":focus")&&$("#ricercaInput").val(g))},select:function(a,e){if(void 0===e.item.data)return!1;if(aData=e.item.data.split("|"),"riferimento"==aData[0])aData=e.item.data.split("|"),$("#ricercaTipo").val(aData[0]),$("#ricercaNazione").val(aData[1]),$("#ricercaKeyUrl").val(aData[2]),$("#ricercaValore").val(aData[2]),$("#ricercaTesto").val(e.item.label),$("#ricercaStringa").val(e.item.data),$("#ricercaComune").val(e.item.data),$("#ricercaInput").val(e.item.label),b=1,m=valRicercaTipo=aData[0],v=valRicercaNazione=aData[1],d=valRicercaKeyUrl=aData[2],p=valRicercaValore=aData[2],h=valRicercaTesto=e.item.label,f=valRicercaStringa=e.item.data,g=valRicercaInput=e.item.label,$("#boxSearchAreaModifica").hide();else if("provincia"==aData[0])$("#boxSearchArea, #boxSearchOverlay").hide(),$("#ricercaInput").val(e.item.label),$("#ricercaStringa").val(e.item.label),$("#ricercaRegioneSigla").val(aData[7]),g=valRicercaInput=e.item.label,m=valRicercaTipo=aData[0],v=valRicercaNazione=aData[1],d=valRicercaKeyUrl=aData[2],p=valRicercaValore=aData[3],h=valRicercaTesto=e.item.label,f=valRicercaStringa=e.item.label,o=aData,l=1,n=o[2].toUpperCase()+" (Provincia)",$("#ricercaInput").val(n),$("#ricercaTipo").val(o[0]),$("#ricercaKeyUrl").val(o[4]),$("#ricercaKeyUrl").val(o[4]),$("#ricercaValore").val(o[3]),$("#ricercaStringa").val(o[4]),$("#ricercaTesto").val(n),$("#ricercaDistretto").val(""),$("#ricercaQuartiere").val(""),$("#ricercaComune").val(""),$("#ricercaRegione").val(o[8]),valRicercaInput=n,1!=l?$("#boxSearchAreaModifica").show():$("#boxSearchAreaModifica").hide();else{var t=$("#ricercaDistretto").val(),i=$("#ricercaQuartiere").val();$("#ricercaComune").val(aData[2]),$("#ricercaRegioneSigla").val(aData[7]),$("#ricercaTipo").val(aData[0]),$("#ricercaNazione").val(aData[1]),$("#ricercaKeyUrl").val(aData[2]),$("#ricercaValore").val(aData[2]),$("#ricercaTesto").val(e.item.label),$("#ricercaStringa").val(e.item.data),$("#ricercaInput").val(e.item.label);var r=aData;m=valRicercaTipo=aData[0],v=valRicercaNazione=aData[1],d=valRicercaKeyUrl=aData[2],p=valRicercaValore=aData[2],h=valRicercaTesto=e.item.label,f=valRicercaStringa=e.item.data;var c=e.item.label+" "+aLang[aData[0]]+" ("+aData[8].toUpperCase()+")";if(g=valRicercaInput=c,ricercaOnLoad.toLowerCase()!=e.item.value.toLowerCase()){t=$("#ricercaDistretto").val(""),i=$("#ricercaQuartiere").val(""),t=$("#ricercaDistretto").val(),i=$("#ricercaQuartiere").val();s(aData[0],aData[3],aData[4],t,i,aData[5],aData[7],aData[8],r,c)}else s(aData[0],aData[3],aData[4],t,i,aData[5],aData[7],aData[8],r,c)}var o,l,n},open:function(a,e){navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&$(".ui-autocomplete").off("menufocus")},focus:function(a,e){return!1}}).autocomplete("instance")._renderItem=function(a,e){return void 0===e.data?$("<li>").append("<div class='ricercaLabel'>"+$("#immobiliNoResult").attr("msg")+"</div>").appendTo(a):(aData=e.data.split("|"),sLabel=e.label,sDesc=e.desc,sTitolo="",1==aData[6]?(0==precisoCount&&(sTitolo="<div class='ricercaLabelTitolo'>"+aLang.risultatiMigliori+"</div><div style='clear:both'></div>",precisoCount++),sLabel="<strong>"+sLabel+" "+aLang[aData[0]]+" ("+aData[8].toUpperCase()+")</strong>"):"provincia"==aData[0]&&0==provinceCount?(sTitolo="<div class='ricercaLabelTitolo'>"+aLang.province+"</div><div style='clear:both'></div>",provinceCount++):"comune"==aData[0]&&0==comuniCount?(sTitolo="<div class='ricercaLabelTitolo'>"+aLang.comuni+"</div><div style='clear:both'></div>",comuniCount++):"distretto"==aData[0]&&0==distrettiCount?(sTitolo="<div class='ricercaLabelTitolo'>"+aLang.distretti+"</div><div style='clear:both'></div>",distrettiCount++):"localita"==aData[0]&&0==localitaCount&&(sTitolo="<div class='ricercaLabelTitolo'>"+aLang.localitas+"</div><div style='clear:both'></div>",localitaCount++),$("<li>").append(sTitolo+"<div class='ricercaLabel'>  "+sLabel+"</div><div class='ricercaDesc'> "+sDesc+"</div><div style='clear:both'></div>").appendTo(a))}),$("#ricercaImmobili").submit(function(){$("#ricercaButton").unbind("click"),$("#cercaMappa").prop("disabled",!0),$("#modificaMappa").prop("disabled",!0),$("#boxSearchAreaConferma").prop("disabled",!0);var a=$(this).serialize();salvaRicercaRecente(a)}),$("#ricercaButton").on("click",function(){controlloPulsante=1,""!==$("#ricercaValore").val()&&$("#ricercaImmobili").submit()}),$("#ricercaButtonSotto").on("click",function(){$("#ricercaButton").trigger("click")}),$("input.listaImmobiliAjax, select.listaImmobiliAjax").on("change",function(){conteggioFiltri();var a=$("#ricercaImmobili").serialize();$(".immobiliListaAnnunciCaricamento").show(),eseguiRicerca(a)}),$("form#ricercaImmobili").find(".valoreRange").on("focusout",function(){sNomeCampo=$(this).data("id"),sNomeCampoM=sNomeCampo.substr(0,1).toUpperCase()+sNomeCampo.substr(1),sValoreMin=$("form#ricercaImmobili").find("input[name='ricerca"+sNomeCampoM+"Min']").val(),sValoreMax=$("form#ricercaImmobili").find("input[name='ricerca"+sNomeCampoM+"Max']").val(),""==sValoreMin&&""==sValoreMax?sContenutoRange=aLang[sNomeCampo+"RangeTitolo"]:""!=sValoreMin&&""!=sValoreMax?(sContenutoRange=aLang[sNomeCampo+"DaA"].replace("{0}",sValoreMin),sContenutoRange=sContenutoRange.replace("{1}",sValoreMax)):""!=sValoreMin?sContenutoRange=aLang[sNomeCampo+"Da"].replace("{0}",sValoreMin):sContenutoRange=aLang[sNomeCampo+"A"].replace("{0}",sValoreMax),$("form#ricercaImmobili").find("#"+sNomeCampo+"RangeTesto").html(sContenutoRange)}),$("form#ricercaImmobili").find(".valoreRange").trigger("focusout"),$("#ricercaInput").focus(function(){""!=$(this).val()&&(valRicercaInput=$(this).val(),$(this).val(""))}),$("#ricercaInput").blur(function(){"undefined"!=typeof valRicercaInput&&$(this).val(valRicercaInput)}),$(document).on("click","#boxSearchOverlay",function(){e(),$("#boxSearchArea, #boxSearchOverlay").hide()}),$(document).on("click","#boxSearchAreaConferma",function(a){e(),"area-riservata"==$("body").attr("id")&&(a.preventDefault(),$("#boxSearchArea, #boxSearchOverlay").hide())}),$("#boxSearchAreaModifica").click(function(){valRicercaInput=$("#ricercaInput").val(),s($("#ricercaTipo").val(),$("#ricercaValore").val(),$("#ricercaStringa").val(),$("#ricercaDistretto").val(),$("#ricercaQuartiere").val(),$("#ricercaComuneId").val(),$("#ricercaRegioneSigla").val(),$("#ricercaProvinciaSigla").val(),null,$("#ricercaInput").val())}),"quartiere"!=$("#ricercaTipo").val()&&"distretto"!=$("#ricercaTipo").val()&&"comune"!=$("#ricercaTipo").val()||""==$("#ricercaDistretto").val()&&""==$("#ricercaQuartiere").val()||$("#boxSearchAreaModifica").show()}function e(){var e=0,t="",i=0,r="",c="";if(0<$("#boxSearchArea input[type=checkbox]:checked").length){if($("#boxSearchArea input[type=checkbox]").each(function(){var a=$(this).attr("tipo");$(this).is(":checked")&&("Distretto"==a?(c=a.toLowerCase(),t+=$(this).attr("value")+"|",sComuneNome=$(this).attr("comunenome"),sComuneKeyUrl=$(this).attr("comunekeyurl"),sComuneId=$(this).attr("comuneid"),sNazione=$(this).attr("nazione"),e++):"Quartiere"==a?(c=a.toLowerCase(),r+=$(this).attr("value")+"|",t+=$(this).attr("value")+"|",sComuneNome=$(this).attr("comunenome"),sComuneKeyUrl=$(this).attr("comunekeyurl"),sComuneId=$(this).attr("comuneid"),sNazione=$(this).attr("nazione"),i++):u($(this)),interoDistrettoSelezionato($(this))&&$(this).siblings(".lista-quartieri").find("input[type=checkbox]").prop("checked",!1))}),t=t.substring(0,t.length-1),r=r.substring(0,r.length-1),$("#ricercaDistretto").val(""),$("#ricercaQuartiere").val(""),0<e){if(1==e){oDistrettoSelect=$("#boxSearchArea .checkbox-distretto input[tipo=Distretto][value='"+t+"']");var a=oDistrettoSelect.next().text().trim().split("(")[0];$("#ricercaTipo").val(c),$("#ricercaInput").val(a+" (DISTRITO)"),$("#ricercaStringa").val(a+" (DISTRITO)"),$("#ricercaComune").val(oDistrettoSelect.attr("keyurl")),$("#ricercaKeyUrl").val(oDistrettoSelect.attr("keyurl")),$("#ricercaValore").val(t),$("#ricercaNazione").val(oDistrettoSelect.attr("nazione")),$("#ricercaDistretto").val(t),$("#ricercaComuneId").val(sComuneId)}else $("#ricercaTipo").val("comune"),$("#ricercaInput").val(sComuneNome.toUpperCase()+" ("+e+" "+aLang.distrettiSelezionati+")"),$("#ricercaKeyUrl").val(sComuneKeyUrl),$("#ricercaValore").val(sComuneId),$("#ricercaDistretto").val(t),$("#ricercaQuartiere").val(r),$("#ricercaNazione").val(sNazione);$("#ricercaTesto").val($("#ricercaInput").val()),$("#boxSearchAreaModifica").show()}if(0<i){if(1==i){oDistrettoSelect=$("#boxSearchArea .list-group-item[value='"+r+"']");a=$("#boxSearchArea .list-group-item[value='"+r+"']").next().text().trim().split("(")[0];$("#ricercaTipo").val(c),$("#ricercaInput").val(a+" (BARRIO)"),$("#ricercaKeyUrl").val(oDistrettoSelect.attr("keyurl")),$("#ricercaValore").val(r),$("#ricercaNazione").val(oDistrettoSelect.attr("nazione")),$("#ricercaQuartiere").val(r),$("#ricercaComuneId").val(sComuneId),$("#ricercaComune").val(sComuneId)}else $("#ricercaTipo").val("comune"),$("#ricercaInput").val(sComuneNome.toUpperCase()+" ("+i+" "+aLang.quartieriSelezionati+")"),$("#ricercaKeyUrl").val(sComuneKeyUrl),$("#ricercaValore").val(sComuneId),$("#ricercaQuartiere").val(r),$("#ricercaNazione").val(sNazione);0<i&&0<e&&($("#ricercaTipo").val("comune"),$("#ricercaValore").val(sComuneId),$("#ricercaInput").val(sComuneNome.toUpperCase()+" ("+i+" "+aLang.quartieriSelezionati+" "+aLang.e+" "+e+" "+aLang.distrettiSelezionati+")")),$("#ricercaTesto").val($("#ricercaInput").val()),$("#boxSearchAreaModifica").show()}}else $("#ricercaDistretto").val(""),$("#ricercaQuartiere").val(""),$("#cerca-comune-intero").trigger("click")}function r(a,e,t,i){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var r,c,o,l=isFinite(+a)?+a:0,n=isFinite(+e)?Math.abs(e):0,s=void 0===i?",":i,u=void 0===t?".":t,$="";return 3<($=(n?(r=l,c=n,o=Math.pow(10,c),""+Math.round(r*o)/o):""+Math.round(l)).split("."))[0].length&&($[0]=$[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,s)),($[1]||"").length<n&&($[1]=$[1]||"",$[1]+=new Array(n-$[1].length+1).join("0")),$.join(u)}function a(a,e){if((sTipo="")==c||null==c?c="":-1==c.indexOf("#")&&(c="#"+c),nValore=$(c+" input.immobilePrezzo").val().replace(/\./g,""),nCapitale=$(c+" input.mutuoImporto").val().replace(/\./g,""),nCadenza=12,nAnniMutuo=$(c+" select.mutuoDurata").val(),nTasso=$(c+" select.mutuoDurata option:selected").attr("rel"),nLimitMutuo=nValore/100*100,nCapitale>nLimitMutuo&&(nCapitale=nLimitMutuo),$(".tassoChange").html(nTasso.replace(".",",")+"%"),parseInt(nCapitale)<=parseInt(nValore)){for($(".mutuoRata"+sTipo).html(0),nMesiMutuo=nAnniMutuo*nCadenza,nTassoMese=nTasso/(100*nCadenza),nTarroCalcolo=nTassoMese+1,nMesiCalcolo=nMesiMutuo-1,nSomma=0,i=0;i<nMesiCalcolo;i++)nPow=Math.pow(nTarroCalcolo,i),nSomma+=nPow;nPot=Math.pow(nTarroCalcolo,nMesiMutuo),nRata=nCapitale*nPot/nSomma,nTassoot=nRata*nMesiMutuo,nInteressi=nTassoot-nCapitale,nMutuoPerc=parseInt(nCapitale/nValore*100),nMutuoPercAnticipo=100-nMutuoPerc,nRata<1&&(nRata=0),1<nRata&&(nRata=r(nRata,0,",","."));var t=jQuery.validator.format(aLang.prezzo);$(".mutuoRata"+sTipo).html(t(nRata)),$(".mutuoPercAnticipo").html(nMutuoPercAnticipo),$(".mutuoPerc").html(parseInt(nMutuoPerc))}$("input.mutuoImporto").val(r(nCapitale,0,",",".")),$("input.immobilePrezzo").val(r(nValore,0,",",".")),$("select.mutuoDurata option[value="+nAnniMutuo+"]").prop("selected",!0),$(".selectpicker").selectpicker("refresh"),$(".mutuoRataSel").html(t(nRata)),console.log(t(nRata)),null===a&&$.each(o,function(a,e){e.data.datasets[0].data[0]=nMutuoPerc,e.data.datasets[0].data[1]=nMutuoPercAnticipo,e.update()})}if($(".selectpicker").selectpicker(),contratto=$(".immobiliLista").attr("contratto"),$("input#contratto").val(contratto),$("#"+contratto).addClass("active"),$('#immobiliSelectStrutturaTab a[href="#'+contratto+'"]').tab("show"),$(".tabContratto").click(function(){contratto=$(this).attr("contratto"),$(".buttonSelectStruttura").attr("contratto",contratto),$("input#contratto").val(contratto)}),$("body").on("change","#listaOrdinaSelect",function(){$("form#ricercaImmobili").find("input[name='ricercaOrdinamento']").val($(this).val()),$("form#ricercaImmobili").submit()}),$(".imgPlanimetriaImmagine").click(function(a){$(".imgPlanimetriaImmagineModal").attr("src",$(this).attr("data-img-url"))}),0!==$(".calcoloMutuo").length){var c;a(1),$(".immobilePrezzoBox").on("click","#containerRataMutuoDet",function(a){$("#modalCalcolaMutuo").modal("show")}),$(".calcoloMutuoValue").keyup(function(){c=$(this).closest("form").attr("id"),a(null)}),$(".calcoloMutuoValue").change(function(){c=$(this).closest("form").attr("id"),a(null)}),Chart.defaults.global.legend.display=!1;var o=[];$.each($(".mutuoChart"),function(a,e){ctx=e;var t=new Chart(ctx,{type:"doughnut",data:{labels:[$("#mutuoLabel").html(),$("#anticipoLabel").html()],datasets:[{data:[nMutuoPerc,nMutuoPercAnticipo],backgroundColor:["#00984b","#2a3e51"],label:"My dataset"}]},options:{cutoutPercentage:70},legend:{display:!1}});o.push(t)})}if($(".link_aggiungiListaDesideri").click(function(a){var t=$(this),e=$(this).attr("rel"),i=t.closest(".immobile").find(".loader");if(0!=utenteLogin&&i.stop().fadeIn(100),t.removeClass("link_aggiungiListaDesideri"),t.hasClass("aggiuntoDesidero")){var r="idImmobile="+e;$.ajax({type:"POST",url:baseUrlLingua+areaPrivataUrl+"/ajax/eliminaListaDesideri",data:{idImmobile:e},success:function(a){if(i.stop().fadeOut(100),"ok"==a){$("."+t.attr("id")).removeClass("aggiuntoDesidero").find(".listaTxt").html('<i class="fa fa-heart-o" aria-hidden="true"></i>');var e=$(".contoAnnunciSalvati .numero").text();$(".contoAnnunciSalvati .numero").text(e-1),t.addClass("link_aggiungiListaDesideri")}}})}else if($(this).hasClass("loggato")){r="idImmobile="+e;var c=$("#modalListaDesideriLogin");$.ajax({type:"POST",url:baseUrlLingua+areaPrivataUrl+"/ajax/aggiungiListaDesideri",data:r,success:function(a){if(i.stop().fadeOut(100),"esiste"==a)c.modal("hide");else{c.modal("hide"),$("."+t.attr("id")).addClass("aggiuntoDesidero").find(".listaTxt").html('<i class="fa fa-heart" aria-hidden="true"></i>');var e=$(".contoAnnunciSalvati .numero").text();$(".contoAnnunciSalvati .numero").text(parseInt(e)+1),t.addClass("link_aggiungiListaDesideri")}}})}else $("#idImmLoginDesideri").val(e)}),$("#salvaRicercaModal").on("shown.bs.modal",function(){$("#salvaRicercaForm").validate({ignore:[],errorPlacement:function(a,e){return e.attr("name")&&("email"==e.attr("name")&&a.insertAfter("#email"),"privacy"==e.attr("name")?$("#salvaRicercaForm label[for=privacyimmSalvaRicerca]").attr("style","color:red"):"privacy_imm"==e.attr("name")?$("#salvaRicercaForm label[for=labelfc_privacySalvaRicerca]").find("a").attr("style","color:red!important"):$("#salvaRicercaForm label[for=labelfc_privacySalvaRicerca]").attr("style","color:red")),!0},rules:{email:{required:!0,verifyemail:!0},privacy:{required:!0},privacy_imm:{}}}),$("#salvaRicercaForm").on("change","input",function(){var a=$(this).attr("id");"privacyimmSalvaRicerca"==a?$(this).valid()?$("#salvaRicercaForm label[for=privacyimmSalvaRicerca]").removeAttr("style"):$("#salvaRicercaForm label[for=privacyimmSalvaRicerca]").attr("style","color:red"):"labelfc_privacySalvaRicerca"==a&&($(this).valid()?$("#salvaRicercaForm label[for=labelfc_privacySalvaRicerca]").find("a").removeAttr("style"):$("#salvaRicercaForm label[for=labelfc_privacySalvaRicerca]").find("a").attr("style","color:red!important"))})}),$(".modal-body").on("click","#inviaSalvaRicerca",function(){var a=$("#salvaRicercaForm"),e=$(this);if(a.valid()){$(this).prop("disabled",!0);var t=a.serialize();$.ajax({type:"POST",async:!1,url:baseUrlLingua+areaPrivataUrl+"/ajax/salvaRicerca",data:t,dataType:"json",success:function(a){"error"==a.status?e.text(aLang.ricercaGiaSalvata).prop("disabled",!0):"devi-registrarti"==a.status?(e.prop("disabled",!0),$("#salvaRicercaModal .messaggio-successo").hide().html(a.msg).slideDown(200)):(e.prop("disabled",!0).text(a.msg),setTimeout(function(){e.text(aLang.attiva).prop("disabled",!1)},4200),0==utenteLogin&&"ok"==a.status&&$("#salvaRicercaModal .messaggio-successo").hide().text(aLang.saraCancellataIn48Ore).slideDown(200).delay(4e3).slideUp(200),"undefined"!=typeof ga&&ga("send","pageview","/obiettivi/form/alertemail/compilato/"))}})}}),$("#salvaRicercaModal").on("hidden.bs.modal",function(){"<p>Ricerca salvata con successo!</p>"==$("#salvaRicercaModal .modal-body").html()&&location.reload(),"<p>Ricerca già salvata!</p>"==$("#salvaRicercaModal .modal-body").html()&&location.reload()}),$(document).on("click","#nascondiImm",function(){var a=$(this),e=a.attr("rel"),t="idImmobile="+e,i=a.closest(".immobile").find(".loader");i.stop().fadeIn(300),$.ajax({type:"POST",url:baseUrlLingua+areaPrivataUrl+"/ajax/salvaNascondi",data:t,success:function(a){i.stop().fadeOut(300),"ok"==a&&($(".dettaglioNascondi").fadeOut(300),0<$(".schedaImmobile").length?$("#infoNascondi").show("slow"):$("#contRow"+e).fadeOut("slow"))}})}),$(document).on("change","#ricercaCategoria",function(){var a=$(this).val();$("#ricercaCategoria").val(a),"can"==a?$("#contRicerca").hide():"none"==$("#contRicerca").css("display")&&$("#contRicerca").show()}),0<$("#ricercaImmobili").length){var l="area-riservata"==$("body").attr("id");$("#ricercaImmobili").validate({ignore:[],rules:{nomeRicerca:{required:!0},ricercaInput:{required:l}}})}function n(){var c=$(".schedaAnnuncioGalleriaImmagini").width(),o=$(".schedaAnnuncioGalleriaImmagini").height();$(".galleriaPlanimetrieContent").each(function(){var a=$(this).width(),e=$(this).height(),t=e;if(c<a){var i=c-20;t=o*(r=i/a-.005);$(this).css("width",i+"px"),$(this).children().css("background-size",i+"px Auto"),$(this).find(".iconaPlanimetriaFoto").each(function(){nIconaLeft=S[$(this).attr("id")+"_left"]*r,nIconaTop=S[$(this).attr("id")+"_top"]*r,$(this).css("left",nIconaLeft+"px"),$(this).css("top",nIconaTop+"px")}),$(this).css("margin","initial")}if(o<t){var r=(t=o-20)/e-.005;$(this).css("width",t+"px"),$(this).children().css("background-size","Auto "+t+"px"),$(this).find(".iconaPlanimetriaFoto").each(function(){nIconaLeft=S[$(this).attr("id")+"_left"]*r,nIconaTop=S[$(this).attr("id")+"_top"]*r,$(this).css("left",nIconaLeft+"px"),$(this).css("top",nIconaTop+"px")}),$(this).css("margin","initial")}})}$(document).on("click","#salvaRicercaAreaRiservata",function(){if(form=$("#ricercaImmobili"),form.valid()){form.closest(".immobilifiltroRicerca").find(".loader").show();$.ajax({type:"POST",url:baseUrlLingua+areaPrivataUrl+"/ajax/salvaRicerca",data:form.serialize(),dataType:"json",success:function(a){"ok"==a.status?(form[0].reset(),location.reload()):"esiste"==a.status&&$("#msgForm").html(a.msg)}})}}),$("#salvaRicercaAreaRiservataSotto").on("click",function(){$("#salvaRicercaAreaRiservata").trigger("click")}),$(document).on("click",".eliminaRicerca",function(){$("#inputIDricerca").val($(this).data("id")),$("#inputCodice").val($(this).data("codice")),$("#modalDeleteRicerca").modal("show")}),$(document).on("click","#confermaCancellaRicerca",function(){var a="idRicerca="+$("#inputIDricerca").val()+"&codice="+$("#inputCodice").val();$.ajax({type:"POST",async:!1,url:baseUrlLingua+areaPrivataUrl+"/ajax/cancellaRicerca",data:a,dataType:"json",success:function(a){200==a.response.status_code?($("#modalDeleteRicerca").modal("hide"),location.reload()):$("#msgForm").html("<p>Error "+a.response.message+"!</p>")}})}),$(document).on("change",".frequenza_invio",function(){var a="idRicerca="+$(this).attr("rel")+"&frequenza_invio="+$(this).val();$.ajax({type:"POST",async:!1,url:baseUrlLingua+areaPrivataUrl+"/ajax/aggiornaFrequenzaRicerca",data:a,success:function(a){"ok"==a&&location.reload()}})}),$(".salvaRicercaRecente").click(function(){var a=$(this).off("click").attr("rel");$.ajax({url:baseUrlLingua+"ajax/getRicercaRecente",data:{idRicerca:a},dataType:"json",success:function(a){var e;e=a,$.ajax({url:baseUrlLingua+areaPrivataUrl+"/ajax/salvaRicerca",method:"post",data:{ricerca:e},success:function(a){location.reload()}})}})});var S=new Array;$(".galleriaPlanimetrieContent").each(function(){$(this).find(".iconaPlanimetriaFoto").each(function(){sIconaId=$(this).attr("id"),S[sIconaId+"_left"]=parseInt($(this).css("left"),10),S[sIconaId+"_top"]=parseInt($(this).css("top"),10)})}),n(),$(window).resize(function(){n()}),$("input#prossimo_invio").remove(),$(document).on("click","#boxSearchAreaList label",function(){$(this).siblings(".lista-quartieri").slideToggle()}),$(document).on("click","#cerca-comune-intero",function(){var a=$(this).data("id-comune");$("input[name=ricercaTipo]").val("comune"),$("input[name=ricercaDistretto]").val(""),$("input[name=ricercaQuartiere]").val(""),$("input[name=ricercaComune]").val(a),$("input[name=ricercaValore]").val(a),$("input[name=ricercaComuneId]").val(a),0==$("#areaRiservata").length?$(this).closest("form").submit():$("#boxSearchArea, #boxSearchOverlay").hide()})}),ricercaOnLoad="",jQuery(document).ready(function(o){ricercaOnLoad=o("#ricercaComune").val(),o("form#salvaRicercaForm select.ricercaTipologia option").first().text(aLang.qualsiasi),o("#ricercaImmobili").on("change","#ricercaContratto",function(){"alquiler"==o("select#ricercaContratto").val()?o(".totJS").hide():o(".totJS").show()}),o("form#ricercaImmobili input").on("change",function(){$this=o(this),nome=$this.attr("name"),sInput=o("form#salvaRicercaForm input[name="+nome+"]"),valore=$this.val(),"checkbox"==$this.attr("type")?$this.is(":checked")?sInput.prop("checked",!0):sInput.prop("checked",!1):sInput.val(valore)}),o("form#ricercaImmobili select").on("change",function(){var a=o(this),e=a.attr("name"),t=a.val(),i=o("form#salvaRicercaForm select[name="+e+"]"),r=i.find("option[value="+t+"]");i.find("option").removeAttr("selected"),r.attr("selected",!0),i.selectpicker("val",t)}),o("#salvaRicercaModal").on("shown.bs.modal",aggiornaRiepilogoSalvaRicerca),o("#pulsante-riepilogo").on("click",aggiornaRiepilogoSalvaRicerca);var l=o("#selectDistrettiContainer .selectpicker");l.on("change",function(){var a=l.val()?l.val().length:0,e=o("#salvaRicercaForm #ricercaInput"),t=o("#salvaRicercaForm input[name=ricercaStringa]"),i=o("#salvaRicercaForm input[name=ricercaTesto]"),r=1==a?aLang.distrettoSelezionato:aLang.distrettiSelezionati,c=e.attr("placeholder").replace(/\(.+(?=\))/,"("+a+" "+r);0==a&&(c=e.attr("placeholder").replace(/\(.+(?=\))/,"("+aLang.comune).toUpperCase()),e.attr("placeholder",c),t.val(c),i.val(c)}),o("body").on("change",".checkbox-distretto>input[tipo=Distretto]",function(){var a=o(this).closest(".checkbox-distretto");a.find("input[tipo=Distretto]").is(":checked")?a.addClass("ha-quartieri-selezionati"):a.removeClass("ha-quartieri-selezionati")}),o("body").on("change","li.quartiere input",function(){var a=o(this).closest(".checkbox-distretto"),e=a.find("input[type=checkbox]").val();haQuartieriSelezionati(a)?(a.addClass("ha-quartieri-selezionati"),addArea(o("area[data-idarea="+e+"]"),e)):(a.removeClass("ha-quartieri-selezionati"),deleteArea(o("area[data-idarea="+e+"]"),e))})});